---
- name: create user
  user:
    name: '{{ user_name }}'
    comment: '{{ full_name }}'
    password: '{{ password }}'
    create_home: true
    skeleton: /etc/skel
    groups: wheel
    ssh_key_file: .ssh/id_ed25519
    ssh_key_type: ed25519

- name: copy bashrc
  copy:
    src: bashrc
    dest: /home/{{ user_name }}/.bashrc
    owner: '{{ user_name }}'
    mode: '0644'

- name: create projects folder
  file:
    /home/{{ user_name }}/projects

- name: setup git config
  git_config:
    name: '{{ item.name }}'
    value: '{{ item.value }}'
  loop:
    - { name: user.name, value: '{{ git_user_name }}' }
    - { name: user.email, value: '{{ user_email }}' }

- name: install sudo package
  become: true
  pacman:
    name:
    - sudo
    state: present

- name: enable sudo
  lineinfile:
    dest: /etc/sudoers
    state: present
    search_string: '# %wheel ALL=(ALL:ALL) ALL'
    line: '%wheel ALL=(ALL:ALL) ALL'
    present: true
    validate: visudo -cf %s
  become: true
